
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>foodie-kiosk-experience</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <!-- Improved cache control meta tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta property="og:title" content="Lovable Generated Project" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- Inline error recovery script - runs before other scripts -->
    <script>
      // Detect any previous errors persisting across reloads
      if (sessionStorage.getItem('module_error_recovery') === 'true') {
        console.warn('Previous page load had module errors - using aggressive cache clearing');
        sessionStorage.removeItem('module_error_recovery');
        
        // Clear all caches immediately 
        if ('caches' in window) {
          caches.keys().then(keys => keys.forEach(key => caches.delete(key)));
        }
      }
      
      // Enhanced cache clearing utility
      window.clearCache = async function() {
        try {
          // 1. Clear Cache API if available
          if ('caches' in window) {
            const cacheKeys = await caches.keys();
            await Promise.all(cacheKeys.map(key => caches.delete(key)));
            console.log('Cache cleared successfully');
          }
          
          // 2. Notify service worker if active
          if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({ action: 'CLEAR_CACHES' });
          }
          
          // 3. Clear localStorage and sessionStorage
          localStorage.clear();
          sessionStorage.clear();
          
          // 4. Force reload with cache bust parameter
          const cacheBust = Date.now();
          const url = new URL(window.location.href);
          url.searchParams.set('cache_bust', cacheBust.toString());
          window.location.href = url.toString();
          
          return true;
        } catch (error) {
          console.error('Failed to clear cache:', error);
          // Last resort - simple reload
          window.location.reload(true);
          return false;
        }
      };
      
      // Error handler for script loading failures
      window.addEventListener('error', function(event) {
        // Only handle script errors before app loads
        if (event.filename && event.filename.includes('.js') && !window.appLoaded) {
          console.error('Script loading error detected:', event);
          
          // If error persists after reload attempts, show user-friendly message
          if (sessionStorage.getItem('reload_attempts')) {
            const attempts = parseInt(sessionStorage.getItem('reload_attempts') || '0');
            if (attempts >= 2) {
              document.body.innerHTML = `
                <div style="padding: 2rem; text-align: center; font-family: system-ui, sans-serif;">
                  <h2 style="color: #e11d48;">Unable to load application</h2>
                  <p>We're experiencing technical difficulties. Please try again later or contact support.</p>
                  <button onclick="window.clearCache()" style="padding: 0.5rem 1rem; background: #2563eb; color: white; border: none; border-radius: 0.25rem; margin-top: 1rem; cursor: pointer;">
                    Clear Cache & Reload
                  </button>
                </div>
              `;
              sessionStorage.removeItem('reload_attempts');
              return;
            }
            
            sessionStorage.setItem('reload_attempts', (attempts + 1).toString());
          } else {
            sessionStorage.setItem('reload_attempts', '1');
          }
          
          // Auto-reload on script errors
          setTimeout(function() {
            window.clearCache();
          }, 1000);
        }
      }, true);
      
      // Check for outdated cache on load
      document.addEventListener('DOMContentLoaded', function() {
        // Mark app as loaded to prevent certain error handlers
        window.appLoaded = true;
        
        // Clear reload attempts counter on successful load
        sessionStorage.removeItem('reload_attempts');
        
        // Create timestamp for this session
        const currentTimestamp = Date.now();
        const lastCacheUpdate = localStorage.getItem('app_cache_timestamp');
        
        // If no timestamp exists or it's older than 24 hours, update it and clear cache
        const CACHE_MAX_AGE = 24 * 60 * 60 * 1000; // 24 hours
        if (!lastCacheUpdate || (currentTimestamp - parseInt(lastCacheUpdate, 10)) > CACHE_MAX_AGE) {
          localStorage.setItem('app_cache_timestamp', currentTimestamp.toString());
          // Only auto-clear in production (not during development)
          if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('.lovable.dev')) {
            console.log('Cache may be outdated, refreshing content...');
            setTimeout(function() {
              window.clearCache();
            }, 1000); // Delay slightly to allow page to render first
          }
        }
      });
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
